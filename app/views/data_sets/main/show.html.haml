%div{ id: "dataSet", data_set_id: @data_set.id }

%hr/
#dataSetName.text-center
  =link_to("##{@data_set.id} #{@data_set.name}", @data_set)
%hr.mb-0/

.d-flex.justify-content-between.align-items-center.small
  .text-secondary
    created by #{@data_set.account.name}
  .text-secondary
    created at: #{@data_set.created_at}#{@data_set.updated_early? ? " | updated at: #{@data_set.updated_at}" : ""}

.row.align-items-stretch.mt-4
  .col-xl-8.col-sm-12
    #dataSetInfo
      .card
        .card-header.p-1.small
          .d-flex.justify-content-between.align-items-center
            MAIN INFO
            #dataSetStatusComment
              =render 'status_comment'
            .d-flex.align-items-center
              -if @permissions['edit_form']
                #editDataSet
                  %button{ type: 'button', class: 'p-0 btn btn-sm btn-link', 'data-toggle' => "modal", 'data-target' => "#updateDataSetModal" }
                    [ edit ]
              -if @permissions['status'].values.any?
                #scrapeTaskStatus.d-inline-block
                  -if @permissions['status']['edit_form']
                    =render 'statuses'
                  -elsif @permissions['status']['show']
                    =@data_set.status.name
        .card-body
          =render 'data_set_info'
  .col-xl-4.col-sm-12.pl-xl-0
    .card.h-100
      .card-header.p-1.small
        CONVERSATION
      .card-body

-if @permissions['edit_form']
  #updateDataSetModal.modal.fade.pr-0{ "aria-hidden" => "true", "aria-labelledby" => "updateDataSetModal",
                                           'data-backdrop' => 'static', "data-keyboard" => "false" }
    .modal-dialog.modal-dialog-scrollable.modal-lg
      .modal-content
        .modal-header
          UPDATE SCRAPE TASK
          %button.close{ "aria-label" => "Close", "data-dismiss" => "modal", type: "button" }
            %span{ "aria-hidden" => "true" } Ã—
        .modal-body.small
          =render 'edit'
        .modal-footer.justify-content-center
          =link_to('UPDATE', '#', id: 'updateDataSetButton', class: 'btn btn-sm btn-dark')
          .btn.btn-sm.btn-outline-secondary{ "aria-label" => "Close", "data-dismiss" => "modal", type: "button" }
            CANCEL

  :javascript
    document.querySelector('#updateDataSetButton').addEventListener('click', (event) => {
      event.preventDefault();
      document.querySelector('#hiddenUpdateDataSetButton').click();
    }, false);

-if @permissions['instructions']['edit_form']
  #scrapeInstructionAnchor.mb-4
-if @permissions['evaluation_document']['edit_form']
  #scrapeEvaluationDocAnchor.mb-4

-if @permissions['instructions']['show'] && @permissions['evaluation_document']['show']
  #scrapeInstructionAnchor
  #scrapeEvaluationDocAnchor

  %ul#scrapeTaskTabs.nav.nav-tabs.small
    %li.nav-item.text-center{ style: 'width: 50%' }
      %a#scrapeInstructionTab.nav-link.active{ "aria-selected" => "true", "data-toggle" => "tab", href: "#scrapeInstruction", role: "tab" }
        Instruction

    %li.nav-item.text-center{ style: 'width: 50%' }
      %a#scrapeEvaluationDocTab.nav-link{ "aria-selected" => "false", "data-toggle" => "tab",
                                          href: "#scrapeEvaluationDoc", role: "tab" }
        Evaluation Document

  #scrapeTaskTabsContent.tab-content
    #scrapeInstruction.tab-pane.fade.show.active
      .card.border-top-0.rounded-top-0.mb-5
        -if @permissions['instructions']['edit_form']
          #scrapeInstructionEdit.small
            .row
              .col-8.offset-2.p-0
                %hr.mb-0.mt-3/
                =button_to('[ edit ]', edit_scrape_task_instruction_path(@scrape_task), class: 'btn btn-sm btn-link', method: :get, remote: true, data: { disable_with: '...'})
                %hr.mt-0/
        #instruction.show{"data-parent" => "#scrapeInstruction"}
          =render 'scrape_tasks/instructions/instruction'
        :javascript
          [...document.querySelectorAll('#instruction .fr-view a')].forEach((el) => {
            el.setAttribute('target', '_black');
            el.setAttribute('rel', 'noopener noreferrer');
          })

    #scrapeEvaluationDoc.tab-pane.fade.show
      .card.border-top-0.rounded-top-0.mb-5
        #evaluationDocEdit.small
          -if @permissions['evaluation_document']['edit_form']
            .row
              .col-8.offset-2.p-0
                %hr.mb-0.mt-3/
                .d-inline-block
                  =button_to('[ edit ]', edit_scrape_task_evaluation_doc_path(@scrape_task), class: 'btn btn-sm btn-link', method: :get, remote: true, data: { disable_with: '...'})
                %hr.mt-0/
        #evaluationDoc.show{ "data-parent" => "#scrapeEvaluationDoc" }
          =render 'scrape_tasks/evaluation_docs/evaluation_doc'
        :javascript
          [...document.querySelectorAll('#evaluationDoc .fr-view a')].forEach((el) => {
            el.setAttribute('target', '_black');
            el.setAttribute('rel', 'noopener noreferrer');
          })

-elsif @permissions['instructions']['show']
  .card.w-100.mb-5
    .card-header.p-1.small
      INSTRUCTIONS
    .card-body.p-0
      -if @permissions['instructions']['edit_form']
        #scrapeInstructionEdit.small
          .row
            .col-8.offset-2.p-0
              %hr.mb-0.mt-3/
              =button_to('[ edit ]', edit_scrape_task_instruction_path(@scrape_task), class: 'btn btn-sm btn-link', method: :get, remote: true, data: { disable_with: '...'})
              %hr.mt-0/
      #instruction.show{"data-parent" => "#scrapeInstruction"}
        =render 'scrape_tasks/instructions/instruction'
      :javascript
        [...document.querySelectorAll('#instruction .fr-view a')].forEach((el) => {
          el.setAttribute('target', '_black');
          el.setAttribute('rel', 'noopener noreferrer');
        })


-elsif @permissions['evaluation_document']['show']
  .card.w-100.mb-5
    .card-header.p-1.small
      EVALUATION DOCUMENT
    .card-body.p-0
      -if @permissions['evaluation_document']['edit_form']
        #evaluationDocEdit.small
          .row
            .col-8.offset-2.p-0
              %hr.mb-0.mt-3/
              .d-inline-block
                =button_to('[ edit ]', edit_scrape_task_evaluation_doc_path(@scrape_task), class: 'btn btn-sm btn-link', method: :get, remote: true, data: { disable_with: '...'})
              %hr.mt-0/
    #evaluationDoc
      =render 'scrape_tasks/evaluation_docs/evaluation_doc'
    :javascript
          [...document.querySelectorAll('#evaluationDoc .fr-view a')].forEach((el) => {
            el.setAttribute('target', '_black');
            el.setAttribute('rel', 'noopener noreferrer');
          })
