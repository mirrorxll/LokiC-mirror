#changeDataSet_template.row.small
  .col-1
  .col-11
    .row.font-weight-bold
      .col-6.pl-0
        data set
      .col-6
        static year in template / next revision date
    .row
      .col-6.change-ds-form.pl-0
        =render 'change_data_set'
      .col-6.set-static-year-revision-date
        -if @story_type.template.static_year.present?
          .current-static-year-revision-date
            =render 'static_year__revision', show_edit_form: true
          .change-static-year-revision-date-form.d-none
            =render 'static_year__revision_form'
        -else
          .current-static-year-revision-date.d-none
          .change-static-year-revision-date-form
            =render 'static_year__revision_form'

        :javascript
          function showEditStatRev(event) {
            event.preventDefault();

            document.querySelector('.current-static-year-revision-date').classList.toggle('d-none');
            document.querySelector('.change-static-year-revision-date-form').classList.toggle('d-none');

            return false;
          }

          (() => {
            document.querySelector('#current_data_set_page_id').value = $('#data_set').attr('data_set_id');
          })();

          document.querySelector('.current_data_set a[href="#"]').addEventListener('click', function (evt) {
            evt.preventDefault();
            evt.target.parentNode.classList.add('d-none');
            document.getElementsByClassName('change_data_set_form')[0].classList.remove('d-none');
            return false;
          })


%hr.mt-2/

#clientsPublicationsTagsModal.row.small
  .col-1.d-flex.align-items-end.justify-content-end.font-weight-bold
    add:
  .col-11
    .row.font-weight-bold
      .col-3.pl-0
        client
      .col-3.pl-0
        publication
      .col-2
        tag
      .col-4
        sections
    .table_body
      =render partial: 'story_types/clients/client_publication_tag_sections', collection: @story_type.clients_publications_tags
    .row
      .col-12.pl-0
        =render 'story_types/clients/form'

.row
  .col-11.offset-1.pl-0
    %hr/

#excludedClientsPublicationsModal.row.small
  .col-1.text-right.font-weight-bold
    excepted:
  .col-11
    .table_body
      =render partial: 'story_types/clients/excepted_publication', collection: @story_type.excepted_publications
    .p-0
      =form_with(url: include_story_type_excepted_publications_path(@story_type),) do |f|
        =f.collection_select :client_id, Client.where(hidden_for_story_type: false).order(name: :asc), :id, :name,
                             { prompt: '' }, { class: 'mr-2', onchange: 'updatePublicationsByClient(event, this)' }
        =f.collection_select :publication_id, [], :id, :name, {},
                             { onchange: "Rails.fire(this.form, 'submit');" }

      :javascript
        function updatePublicationsByClient(event, select) {
          let clientId = select.value;
          let pubsSelect = select.form.querySelector('select[name="publication_id"]');

          if(clientId === '') { return false; }

          window.$.ajax({
            url: `${window.location.origin}/api/clients/${clientId}/publications`,
            dataType: 'json',
            success: (publications) => {
              let option = document.createElement("option");

              pubsSelect.innerHTML = '';
              pubsSelect.appendChild(option);

              for (let i = 0; i < publications.length; i++) {
                option = document.createElement("option");
                option.setAttribute("value", publications[i].id);
                option.text = publications[i].name;
                pubsSelect.appendChild(option);
              }
            }
          });
        }
%hr/

.row.mb-3.small
  #level__frequency__photo_bucket.col-10.offset-1
    .row.font-weight-bold
      .col-3
        level
      .col-3
        frequency
      .col-3
        photo bucket
    .row
      .col-3.level
        -if @story_type.level
          =render 'story_types/levels/level', level: @story_type.level
        -else
          =render 'story_types/levels/form'
      .col-3.frequency
        -if @story_type.frequency
          =render 'story_types/frequencies/frequency', frequency: @story_type.frequency
        -else
          =render 'story_types/frequencies/form'
      .col-3.photo_bucket
        -if @story_type.photo_bucket
          =render 'story_types/photo_buckets/photo_bucket', photo_bucket: @story_type.photo_bucket
        -else
          =render 'story_types/photo_buckets/form'

.modal-footer
