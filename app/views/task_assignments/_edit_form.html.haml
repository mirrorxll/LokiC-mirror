=form_with(url: task_assignments_path(task),
           html: { class: 'd-inline' }, method: :patch) do |form|
  .row.small.mb-1
    .col
      =icon('fa', 'plus', id: 'add_assignment')
      =icon('fa', 'minus', class: 'ml-2 mr-2', id: 'delete_assignment')
  .row.small
    .col#forms_assignments
      -task.assignment_to.each do |assignment|
        =form.collection_select 'assignment_to[]', Account.all.order([:first_name, :last_name]), :id, :name, { prompt: '' , selected: assignment.id}
  =form.submit 'update', class: 'small mt-1 btn btn-sm btn-outline-dark'
  =link_to('cancel', cancel_task_assignments_path(task), method: :get, remote: true, class: 'small mt-1 btn btn-sm btn-outline-dark')

:javascript
  var accounts = #{raw Account.all.order([:first_name, :last_name]).map{ |account| [account.first_name.to_s + ' ' + account.last_name.to_s, account.id]} };

  $('#add_assignment').click(function () {
    $('#forms_assignments').append(
        `<select id="assignment_ids[]" name="assignment_to[]" class="mt-1 mr-1">${buildSelect(accounts)}</select>`
    );
  });

  $('#delete_assignment').click(function () {
    let forms_assignments = document.getElementById('forms_assignments')
    forms_assignments.removeChild(forms_assignments.lastChild)
  });

  function buildSelect(options) {
    var $select = $('');
    $select += ('<option value="' + '' + '">' + '' + '</option>');
    for (var i = 0; i < options.length; i++) {
      $select += ('<option value="' + options[i][1] + '">' + options[i][0] + '</option>');
    }
    return $select;
  }