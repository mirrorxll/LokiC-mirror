%hr/
.row.justify-content-center
  =link_to("##{@multi_task.id} #{@multi_task.title}", multi_task_path(@multi_task))
%hr/

.row
  .col#assignments
    =render 'multi_tasks/assignments/assignments', task: @multi_task
  .col#task_status.text-right
    -if current_account_permissions('multi_tasks', %w[progress_status edit_form])
      =render 'multi_tasks/progress_statuses/status', task: @multi_task
    -elsif current_account_permissions('multi_tasks', %w[progress_status show])
      =@multi_task.status.name

.row.mt-3
  .col-5
    .mb-1
      =render 'task_info'
      #confirms
        =render 'multi_tasks/receipts/confirm_receipts', task: @multi_task
  .col-7
    .card{style: 'height: 375px;'}
      .card-header.p-1
        .d-flex.justify-content-between.small
          comments
          -if current_account_permissions('multi_tasks', %w[comments new_form]) && (current_account.manager? || current_account.eql?(@multi_task.creator) || current_account.in?(@multi_task.assignment_to))
            #comment_form
              =link_to('[ add comment ]',
                       new_multi_task_comment_path(@multi_task, subtype: 'user comment'),
                       remote: true)
      .card-body
        -if current_account_permissions('multi_tasks', %w[comments show])
          =render 'comments', comments: @comments

-if current_account_permissions('multi_tasks', %w[notes show]) && (current_account.eql?(@multi_task.creator) || current_account.in?(@multi_task.assignment_to))
  #notes.accordion.mt-2
    .card.small
      .card-header.p-1
        %div.row
          .col-11
            %div{"aria-controls" => "#notesCollapse", "aria-expanded" => "true", "data-target" => "#notesCollapse", "data-toggle" => "collapse", type: "button"}
              notes
          .col-1.text-right#linkEditNote
            -if current_account_permissions('multi_tasks', %w[notes edit_form]) && @note
              =render 'multi_tasks/notes/link_edit', note: @note
      #notesCollapse.collapse{"data-parent" => "#notes"}
        =render 'multi_tasks/notes/note', note: @note

-if current_account_permissions('multi_tasks', %w[sub_tasks show])
  #subtasks.accordion.mt-2
    .card.small
      .card-header.p-1
        %div.row
          .col-11
            %div{"aria-controls" => "#subtasksCollapse", "aria-expanded" => "true", "data-target" => "#subtasksCollapse", "data-toggle" => "collapse", type: "button"}
              subtasks
          .col-1.text-right
            -if current_account_permissions('multi_tasks', %w[sub_tasks new_form]) && @multi_task.creator?(current_account)
              =link_to '[ create ]', new_subtask_multi_tasks_path(parent_task: @multi_task), remote: true
      #subtasksCollapse.collapse{"data-parent" => "#subtasks", class: @multi_task.subtasks.count > 0 ? 'show' : '' }
        =render 'subtasks'

.card.mt-2
  .card-header.p-1
    .d-flex.justify-content-between.small
      info
      -if current_account_permissions('multi_tasks', ['edit_form']) && @multi_task.creator?(current_account)
        =link_to '[ edit task ]', edit_multi_task_path(@multi_task), remote: true
  .card-body
    #body
      .row.small.mb-3
        .col-10.offset-1
          .fr-view
            -if @multi_task.checklists.exists?
              %ul
                -@multi_task.checklists.each do |checklist|
                  %li.mb-2
                    =checklist.description
              %hr.mt-3.mb-3
            =@multi_task.description&.html_safe

=render 'multi_tasks/checklists/confirms'
=render 'multi_tasks/tracking_hours/hours_form'

-if current_account_permissions('multi_tasks', ['edit_form'])
  #task.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "properties", role: "dialog", "data-backdrop" => "static", "data-keyboard" => "false" }
    .modal-dialog.modal-dialog-centered.modal-dialog-scrollable{ style: "max-width: 80%;" }
      .modal-content
        .modal-header
        .modal-body

- if %w[comments edit_form].map { |access| current_account_permissions('multi_tasks', [access]) }.any?
  #comment.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "properties", role: "dialog", :tabindex => "-1"}
    .modal-dialog.modal-dialog-centered.modal-xl
      .modal-content
        .modal-body
