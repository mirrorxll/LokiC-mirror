=form_with(url: task_path(@task), method: :patch, html: { onkeypress: "return event.keyCode !== 13;" }) do |form|
  .row.small
    .col
      .form-group
        =form.text_field 'task[title]', placeholder: 'title', class: 'form-control', required: true, value: @task.title, maxlength: 500
      .form-group
        =form.text_area 'task[description]', id: 'task_description', value: @task.description
  %hr/
  .d-flex.small.font-weight-bold.text-center
    .col-6
      .row.mb-2
        .col.text-right
          reminder frequency:
        .col.text-left.small
          =form.collection_select 'task[reminder_frequency]', sorted_reminder_frequencies, :id, :name, { selected: @task.reminder_frequency.nil? ? '' : @task.reminder_frequency.id, prompt: '' }
      .row.mb-2
        .col.text-right
          client:
        .col.text-left.small
          =form.collection_select 'task[client_id]', ClientsReport.all.order(:name), :id, :name, { selected: @task.client.nil? ? '' : @task.client.id, prompt: '' }, style: "width:150px"
      .row.mb-2
        .col.text-right
          access to task and its subtasks:
        .col.text-left
          =form.check_box 'task[access]', class: 'form-check-input ml-0 mt-1', checked: @task.access
    .col-6
      .row.mb-2
        .col.text-right
          gather_task:
        .col.text-left.small
          =form.text_field 'task[gather_task]', value: @task.gather_task
      .row.mb-2
        .col.text-right
          deadline:
        .col.text-left.small
          =form.date_field 'task[deadline]', value: @task.deadline
      .row.mb-2
        -if params[:parent_task].blank?
          .col.text-right
            main_task:
          .col.text-left.small
            =form.collection_select 'task[parent]', Task.where(parent: nil).where.not(status: Status.find_by(name: 'deleted')).order(:id) - [@task], :id, :title_with_id, { selected: @task.parent.nil? ? '' : @task.parent.id, prompt: '' }, style: "width:150px"
  %hr/
  .modal-footer
    =link_to( 'close', '#', class: 'ml-auto btn btn-sm btn-outline-secondary',
              'data-dismiss' => 'modal')
    =form.submit 'save changes', class: 'mr-auto btn btn-sm btn-outline-success'

:javascript
  $('#task').on('hidden.bs.modal', function () {
    $('#task .modal-body').empty();
  });
