-if @iteration.purge_all_samples
  -#empty section
-elsif @iteration.schedule
  -samples = @iteration.samples.where(backdated: false)
  -exported = samples.where.not("pl_#{PL_TARGET}_story_id".to_sym => nil).count
  -ready_to_export = samples.where("pl_#{PL_TARGET}_story_id".to_sym => nil).count

  .small
    -if !@story_type.iteration.eql?(@iteration)
      .row
        .col-10.offset-1
          total exported: #{exported} / #{samples.count}

    -elsif @story_type.staging_table && @iteration.creation && @iteration.schedule

      -if @iteration.export.eql?(true) && !@iteration.removing_from_pl.eql?(true)
        .row
          .col-10.offset-1
            total exported: #{exported} / #{samples.count}
        .row
          .col-10.offset-1
            -if exported < samples.count
              =link_to('extra export!', export_story_type_iteration_exports_path(@story_type, @iteration),
                       class: 'mt-3 btn btn-sm btn-outline-dark',
                       method: :post, remote: true)
              .ml-3.d-inline-block

            .remove_from_pl_button.mt-3.btn.btn-sm.btn-outline-danger
              remove from PL
            =link_to(nil, remove_from_pl_story_type_iteration_exports_path(@story_type, @iteration),
                     class: 'd-none remove_from_pl_link',
                     method: :delete, remote: true)
      -elsif @iteration.export.eql?(false)
        =render 'story_types/spinner', description: 'export in progress'
      -elsif @iteration.removing_from_pl.eql?(true)
        =render 'story_types/spinner', description: 'removing from PL in progress'
      -else
        .row.mb-2
          .col-10.offset-1
            ready to export: #{ready_to_export}
        .row
          .col-10.offset-1
            =link_to('export!', export_story_type_iteration_exports_path(@story_type, @iteration),
                     class: 'mt-3 btn btn-sm btn-outline-dark',
                     method: :post, remote: true)

  :javascript
    document.getElementsByClassName('remove_from_pl_button')[0].addEventListener('click', function(event) {
      let userInput = prompt("Are you sure? Please write 'REMOVE FROM PL'");
      if (userInput !== 'REMOVE FROM PL') return false;
      document.getElementsByClassName('remove_from_pl_link')[0].click();
    })
