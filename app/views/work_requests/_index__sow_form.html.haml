-sow_template = 'https://docs.google.com/document/d/1XGBr8mitj6Ui4uTXiCZnevLx7F-5R0Ru0ZNkBLvXpWI/edit'

=form_with(url: api_work_request_path(work_request), method: :patch) do |f|
  %div.mb-2{ class: "default-link#{work_request.id} #{work_request.default_sow ? '' : 'd-none'}" }
    =link_to('default SOW template', sow_template, target: '_blank', rel: 'noopener noreferrer')
  %div{ class: "sow-link#{work_request.id}" }
    =f.text_field "work_request[sow_#{work_request.id}[link]]", class: 'd-inline-block form-control form-control-sm w-85',
                  value: work_request.sow, onkeypress: 'sowByEnterPress(event, this)'
    .w-10.d-inline-flex.justify-content-center
      .mouse-hover
        =icon('fa', 'sign-in', class: 'fa-lg', onclick: "sowByArrowClick(#{work_requests.id})")
    %span.small.text-danger
      ***link to Google Doc or Spreadsheet

:javascript
  function sowByEnterPress(event, input) {
    if(event.keyCode !== 13 || input.value.trim().length === 0) return false;

    postSow(input);
  }

  function sowByArrowClick() {
    let input = document.querySelector('input[id="work_request[sow_33[link]]"]');

    if(input.value.trim().length === 0) return false;

    postSow(input);
  }

  function postSow(input) {
    let spinner = document.querySelector('#workTypes .loadingSpinner');

    spinner.classList.remove('d-none');

    Rails.ajax({
      type: "POST",
      dataType: 'script',
      url: `#{find_or_create_api_work_types_path}`,
      data: `type_of_work[name]=${encodeURIComponent(input.value)}`,
      success: (data) => {
        input.value = '';
        spinner.classList.add('d-none');

        if(document.querySelector(`.work-type-${data['work_id']}`)) return false;

        document.querySelector('#workTypes .types').insertAdjacentHTML(
          'beforeend',
          `<div class="row mb-2 align-items-center work-type-${data['work_id']}">
            <div class="col-1 text-right">
              <input name="work_request[tf_work_type__${data['work_id']}]" type="hidden" value="0">
              <input type="checkbox" value="1" name="work_request[tf_work_type__${data['work_id']}]" id="work_request[tf_work_type__${data['work_id']}]" checked>
            </div>
            <div class="col-11 pl-0 text-left">
              <label class="m-0" for="work_request[tf_work_type__${data['work_id']}]">${data['work_name']}</label>
            </div>
          </div>`
        )
      }
    });
  }

