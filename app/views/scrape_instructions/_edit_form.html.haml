=form_with(url: scrape_task_scrape_instruction_path(@scrape_task), method: :patch) do |f|
  =f.text_area 'scrape_instruction[body]', id: 'scrapeInstructionBody', value: @scrape_task.scrape_instruction.body

  :javascript
    $.FroalaEditor.DefineIcon('submitInstructionEdit', { NAME: 'check' });
    $.FroalaEditor.RegisterCommand('submitInstructionEdit', {
      title: 'Submit',
      focus: false,
      undo: false,
      refreshAfterCallback: false,
      callback: function () {
        console.log('inst')
        Rails.ajax({
          type: "PATCH",
          dataType: 'script',
          url: `#{scrape_task_scrape_instruction_path(@scrape_task)}`,
          data: `scrape_instruction[body]=${encodeURIComponent(this.html.get())}`
        })
      }
    });

    $.FroalaEditor.DefineIcon('cancelInstructionEdit', {NAME: 'remove'});
    $.FroalaEditor.RegisterCommand('cancelInstructionEdit', {
      title: 'Cancel Edit',
      focus: false,
      undo: false,
      refreshAfterCallback: false,
      callback: function () {
        Rails.ajax({
          type: "GET",
          dataType: 'script',
          url: `#{cancel_edit_scrape_task_scrape_instruction_path(@scrape_task)}`
        })
      }
    });

    $('#scrapeInstructionBody').froalaEditor({
      key: 'KfdolbcqsaA2wzA-13==',
      toolbarSticky: true,
      documentReady: true,
      toolbarButtons: ['undo', 'redo' , '|', 'bold', 'italic', 'underline', 'strikeThrough', 'subscript', 'superscript', 'outdent', 'indent', 'clearFormatting', 'insertTable', 'html', '|', 'submitInstructionEdit', 'cancelInstructionEdit'],
      imageUploadURL: '/images/upload',
      imageUploadMethod: 'POST'
    })
